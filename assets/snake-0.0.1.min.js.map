{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/es6-promise-shim/es6-promise-shim.js","src/App.ts","src/Assets.ts","src/Sound.ts","src/controls/Controls.ts","src/controls/KeyboardControls.ts","src/controls/Keys.ts","src/controls/TouchControls.ts","src/game/Berry.ts","src/game/Game.ts","src/game/Point.ts","src/game/Renderer.ts","src/game/Worm.ts","src/ui/Dom.ts","src/ui/Emitter.ts","src/ui/GameOverPopup.ts","src/ui/LoaderPopup.ts","src/ui/MuteButton.ts","src/ui/Popup.ts","src/ui/Score.ts"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","global","factory","window","defineProperty","Object","defineProperties","slice","Array","prototype","isArray","forEach","floor","Math","abs","ES6","max","isCallable","min","fn","isObject","value","postToMessageQueue","thisArg","TypeError","args","arguments","setTimeout","apply","Promise","executor","this","isPromise","String","setupPromiseInternals","_resolve","bind","reason","_reject","resolve","reject","isThenable","then","resoolve","race","promiseArray","undefined","isSettled","Number","promise","temp1","temp2","isFulfilledPromise","_value","isRejectedPromise","_reason","isPendingPromise","all","values","counter","index","onFulfilled","onRejected","defaultPromiseOnFulfilled","defaultPromiseOnRejected","nextOnFulfilled","nextOnRejected","chainedPromise","result","processPromiseResult","_onFulfilled","push","_onRejected","catch","toString","_state","promiseResolve","isSettledPromise","callback","promiseReject","_isPromise","configurable","isValidPromiseState","state","indexOf","checkPromiseInternals","hasOwnProperty","writable","Dom_1","Popup_1","Assets_1","KeyboardControls_1","TouchControls_1","Game_1","Score_1","MuteButton_1","GameOverPopup_1","LoaderPopup_1","app","App","body","Dom","keyboard","KeyboardControls","touch","TouchControls","score","Score","muteButton","MuteButton","reset","resetPoints","game","pause","_this","paused","started","worm","dead","deattach","Popup","open","header","button","animation","resume","attach","registerServiceWorker","navigator","serviceWorker","register","registration","console","log","scope","err","init","gameCanvas","names","Game","emitter","on","GameEvents","GAME_OVER","mute","Assets","play","beforeinstallprompt","prompt","GameOverPopup","points","ADD_POINT","addPoint","point","KEY","pop","event","toggleMute","document","getElementsByTagName","loaderPopup","LoaderPopup","addEventListener","preventDefault","onblur","loadAll","close","dismiss","error","buttonCallback","location","reload","backdrop","Sound_1","loadImage","path","image","Image","src","onload","onerror","berry","head","Sound","load","loaded","loadAudioCtx","request","XMLHttpRequest","responseType","audioData","response","audioCtx","decodeAudioData","buffer","send","audio","Audio","onloadeddata","source","createBufferSource","connect","destination","start","currentTime","AudioCtx","AudioContext","webkitAudioContext","removeEventListener","Controls","listeners","controllable","splice","triggerKey","key","onKey","Keys_1","Controls_1","KEY_TO_DIRECTION","38","Keys","UP","37","LEFT","40","DOWN","39","RIGHT","87","65","83","68","_super","keyDownCallback","keyCode","which","__extends","remove","MIN_DIFFERENCE","innerWidth","innerHeight","queue","pressTime","moved","onStart","Date","now","onMove","appendPos","touches","clientX","clientY","checkMove","onStop","onCancel","x","y","pos","time","threshold","len","first","last","diffX","diffY","Point_1","Renderer_1","Berry","render","ctx","pulse","margin","size","CELL_SIZE","drawImage","Point","Berry_1","Worm_1","Emitter_1","sizeX","sizeY","canvas","renderer","Renderer","Emitter","gameLoop","deltaTime","frameTime","simulate","updateFrame","requestAnimationFrame","Worm","berries","updateBoard","addBerry","board","segments","p","clearFrame","offset","round","random","tail","isKeyEvent","speed","direction","createNewSegment","swallowing","trigger","shift","WormSegment","width","height","getContext","clearRect","color","moveX","moveY","newHead","drawFace","eyesType","R","dx","dy","fillStyle","strokeStyle","lineWidth","lineJoin","lineCap","beginPath","moveTo","lineTo","stroke","arc","PI","fill","ELEMENT_NODE","template","container","element","nodeType","createElement","innerHTML","findFirstElement","childNodes","generateNamedElements","nodeList","node","item","name","elements","querySelectorAll","getAttribute","append","appendChild","removeChild","setText","text","textNode","createTextNode","innerText","textContent","off","listener","isMatchingListener","param","soundElement","loadMute","localStorage","getItem","classList","add","setItem","sound","params","dom","popup","stopPropagation","BODY_COLORS","hiscore","pointsElement","hiscoreElement","loadHiscore","parseInt","setHiscore","updateBodyColor","style","background"],"mappings":"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","file":"snake-0.0.1.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/*!\n * ES6-Promise-Shim v0.1.1\n * This module provides a lightweight implementation of Promise in pure ES5 code\n * for older browsers or older JavaScript engines.\n *\n * @license Copyright (c) 2017 Ariyan Khan, MIT License\n *\n * Codebase: https://github.com/ariyankhan/es6-promise-shim\n * Date: Jun 15, 2017\n */\n\n\n(function (global, factory) {\n\n    \"use strict\";\n\n    if (typeof module === \"object\" && typeof module.exports === \"object\") {\n        // For the environment like NodeJS, CommonJS etc where module or\n        // module.exports objects are available\n        module.exports = factory(global);\n    } else {\n        // For browser context, where global object is window\n        factory(global);\n    }\n\n    /* window is for browser environment and global is for NodeJS environment */\n})(typeof window !== \"undefined\" ? window : global, function (global) {\n\n    \"use strict\";\n\n    var defineProperty = Object.defineProperty;\n\n    var defineProperties = Object.defineProperties;\n\n    var slice = Array.prototype.slice;\n\n    var forEach = Array.prototype.forEach;\n\n    var isArray = Array.isArray;\n\n    var floor = Math.floor;\n\n    var abs = Math.abs;\n\n    var ES6 = typeof global.ES6 === \"object\" ? global.ES6 : (global.ES6 = {});\n\n    var max = Math.max;\n\n    var min = Math.min;\n\n    var isCallable = function (fn) {\n        return typeof fn === 'function';\n    };\n\n    var isObject = function (value) {\n        return value !== null && (typeof value === \"object\" || typeof value === \"function\");\n    };\n\n    // Now `false` for development purpose\n    var isES6Running = function () {\n        return false;\n    };\n\n    var postToMessageQueue = function (fn, thisArg) {\n        if (!isCallable(fn))\n            throw new TypeError(fn + \" is not a function\");\n        var args = slice.call(arguments, 2);\n        setTimeout(function () {\n            fn.apply(thisArg, args);\n        });\n    };\n\n    var Promise = function Promise(executor) {\n        if (!(this instanceof Promise) || isPromise(this))\n            throw new TypeError(String(this) + \" is not a promise\");\n        if (!isCallable(executor))\n            throw new TypeError(\"Promise resolver \" + String(executor) + \" is not a function\");\n        setupPromiseInternals(this);\n        try {\n            executor((function (value) {\n                this._resolve(value);\n            }).bind(this), (function (reason) {\n                this._reject(reason);\n            }).bind(this));\n        } catch (e) {\n            this._reject(e);\n        }\n    };\n\n    Promise.resolve = function resolve(value) {\n        if (isPromise(value))\n            return value;\n        return new Promise(function (resolve, reject) {\n            if (isThenable(value)) {\n                postToMessageQueue(function () {\n                    try {\n                        value.then(resolve, reject);\n                    } catch (e) {\n                        reject(e);\n                    }\n                });\n            }\n            else\n                resolve(value);\n        });\n    };\n\n    Promise.reject = function reject(reason) {\n        return new Promise(function (resoolve, reject) {\n            reject(reason);\n        });\n    };\n\n    // As the ES5 has no any iterable features, so this method's first\n    // argument should be array or array-like object\n    Promise.race = function race(promiseArray) {\n        if (promiseArray === undefined || promiseArray === null)\n            return new Promise(function (resolve, reject) {\n                postToMessageQueue(reject, undefined, TypeError(\"First argument of Promise.race can not be undefined or null\"));\n            });\n        var length,\n            isSettled = false;\n\n        length = Number(promiseArray.length);\n        length = length !== length ? 0 : length;\n        length = (length < 0 ? -1 : 1) * floor(abs(length));\n        length = max(length, 0);\n\n        return new Promise(function (resolve, reject) {\n            var fn,\n                i = 0;\n            fn = function (promise) {\n                var temp1,\n                    temp2;\n                if (isPromise(promise)) {\n                    if (isFulfilledPromise(promise)) {\n                        if (!isSettled) {\n                            isSettled = true;\n                            postToMessageQueue(function () {\n                                resolve(promise._value);\n                            });\n                        }\n                    }\n                    else if (isRejectedPromise(promise)) {\n                        if (!isSettled) {\n                            isSettled = true;\n                            postToMessageQueue(function () {\n                                reject(promise._reason);\n                            });\n                        }\n                    } else if (isPendingPromise(promise)) {\n                        temp1 = promise._resolve;\n                        temp2 = promise._reject;\n                        defineProperties(promise, {\n                            _resolve: {\n                                value: (function (value) {\n                                    temp1(value);\n                                    if (!isSettled) {\n                                        isSettled = true;\n                                        resolve(value);\n                                    }\n                                }).bind(promise)\n                            },\n                            _reject: {\n                                value: (function (reason) {\n                                    temp2(reason);\n                                    if (!isSettled) {\n                                        isSettled = true;\n                                        reject(reason);\n                                    }\n                                }).bind(promise)\n                            }\n                        });\n                    }\n                } else if (isThenable(promise)) {\n                    postToMessageQueue(function () {\n                        try {\n                            promise.then(function (value) {\n                                if (!isSettled) {\n                                    isSettled = true;\n                                    resolve(value);\n                                }\n                            }, function (reason) {\n                                if (!isSettled) {\n                                    isSettled = true;\n                                    reject(reason);\n                                }\n                            });\n                        } catch (e) {\n                            reject(e);\n                        }\n                    });\n                } else {\n                    if (!isSettled) {\n                        isSettled = true;\n                        postToMessageQueue(function () {\n                            resolve(promise);\n                        });\n                    }\n                }\n            };\n            for(; i < length; ++i) {\n                fn(promiseArray[i]);\n            }\n        });\n    };\n\n    // As the ES5 has no any iterable features, so this method's first\n    // argument should be array or array-like object\n    Promise.all = function all(promiseArray) {\n        if (promiseArray === undefined || promiseArray === null)\n            return new Promise(function (resolve, reject) {\n                postToMessageQueue(reject, undefined, TypeError(\"First argument of Promise.all can not be undefined or null\"));\n            });\n        var counter = 0,\n            length,\n            values;\n\n        length = Number(promiseArray.length);\n        length = length !== length ? 0 : length;\n        length = (length < 0 ? -1 : 1) * floor(abs(length));\n        length = max(length, 0);\n\n        values = new Array(length);\n\n        return new Promise(function (resolve, reject) {\n            var fn,\n                i = 0;\n            if (length === 0)\n                resolve(values);\n            else {\n                fn = function (promise, index) {\n                    var temp1,\n                        temp2;\n                    if (isPromise(promise)) {\n                        if (isFulfilledPromise(promise)) {\n                            values[index] = promise._value;\n                            counter++;\n                            if (counter === length) {\n                                postToMessageQueue(function () {\n                                    resolve(values);\n                                });\n                            }\n                        } else if(isRejectedPromise(promise)) {\n                            postToMessageQueue(function () {\n                                reject(promise._reason);\n                            });\n                        } else if(isPendingPromise(promise)) {\n                            temp1 = promise._resolve;\n                            temp2 = promise._reject;\n                            defineProperties(promise, {\n                                _resolve: {\n                                    value: (function (value) {\n                                        temp1(value);\n                                        values[index] = value;\n                                        counter++;\n                                        if (counter === length) {\n                                            resolve(values);\n                                        }\n                                    }).bind(promise)\n                                },\n                                _reject: {\n                                    value: (function (reason) {\n                                        temp2(reason);\n                                        reject(reason);\n                                    }).bind(promise)\n                                }\n                            });\n                        }\n                    } else if (isThenable(promise)) {\n                        postToMessageQueue(function () {\n                            try {\n                                promise.then(function (value) {\n                                    values[index] = value;\n                                    counter++;\n                                    if (counter === length) {\n                                        resolve(values);\n                                    }\n                                }, function (reason) {\n                                    // If the returned promise is already rejected, then it does nothing\n                                    reject(reason);\n                                });\n                            } catch (e) {\n                                reject(e);\n                            }\n                        });\n                    } else {\n                        values[index] = promise;\n                        counter++;\n                        if (counter === length) {\n                            postToMessageQueue(function () {\n                                resolve(values);\n                            });\n                        }\n                    }\n                };\n                for(; i < length; ++i) {\n                    fn(promiseArray[i], i);\n                }\n            }\n        });\n    };\n\n    Promise.prototype.then = function then(onFulfilled, onRejected) {\n        if (!isPromise(this))\n            throw new TypeError(this + \" is not a promise\");\n        onFulfilled = !isCallable(onFulfilled) ? defaultPromiseOnFulfilled : onFulfilled;\n        onRejected = !isCallable(onRejected) ? defaultPromiseOnRejected : onRejected;\n\n        var chainedPromise = new Promise(function (resolve, reject) {}),\n            nextOnFulfilled,\n            nextOnRejected;\n\n        nextOnFulfilled = function (value) {\n            var result;\n            try {\n                result = onFulfilled(value);\n                processPromiseResult(result, chainedPromise);\n            } catch (e) {\n                chainedPromise._reject(e);\n            }\n        };\n\n        nextOnRejected = function (reason) {\n            var result;\n            try {\n                result = onRejected(reason);\n                processPromiseResult(result, chainedPromise);\n            } catch (e) {\n                chainedPromise._reject(e);\n            }\n        };\n\n        if (isPendingPromise(this)) {\n            this._onFulfilled.push(nextOnFulfilled);\n            this._onRejected.push(nextOnRejected);\n        } else if (isFulfilledPromise(this)) {\n            postToMessageQueue(nextOnFulfilled, undefined, this._value);\n        } else if (isRejectedPromise(this))\n            postToMessageQueue(nextOnRejected, undefined, this._reason);\n        return chainedPromise;\n    };\n\n    var processPromiseResult = function (result, chainedPromise) {\n        var temp1,\n            temp2;\n        if (isPromise(result)) {\n            if (isFulfilledPromise(result))\n                chainedPromise._resolve(result._value);\n            else if (isRejectedPromise(result))\n                chainedPromise._reject(result._reason);\n            else if (isPendingPromise(result)) {\n                temp1 = result._resolve;\n                temp2 = result._reject;\n                defineProperties(result, {\n                    _resolve: {\n                        value: (function (value) {\n                            temp1(value);\n                            chainedPromise._resolve(value);\n                        }).bind(result)\n                    },\n                    _reject: {\n                        value: (function (reason) {\n                            temp2(reason);\n                            chainedPromise._reject(reason);\n                        }).bind(result)\n                    }\n                });\n            }\n        } else if (isThenable(result)) {\n            postToMessageQueue(function () {\n                try {\n                    result.then((function (value) {\n                        this._resolve(value);\n                    }).bind(chainedPromise), (function (reason) {\n                        this._reject(reason);\n                    }).bind(chainedPromise));\n                } catch (e) {\n                    chainedPromise._reject(e);\n                }\n            });\n        } else\n            chainedPromise._resolve(result);\n    };\n\n    Promise.prototype.catch = function (onRejected) {\n        if (!isCallable(this[\"then\"]))\n            throw new TypeError(\"(var).then is not a function\");\n        return this[\"then\"](undefined, onRejected);\n    };\n\n    // Although this method is not standard i.e. is not a part of ES6,\n    // but it is given for testing purpose\n    Promise.prototype.toString = function () {\n        if (!isPromise(this))\n            throw new TypeError(this + \" is not a promise\");\n        switch (this._state) {\n            case \"pending\":\n                return \"Promise { <pending> }\";\n            case \"fulfilled\":\n                return \"Promise { \" + this._value + \" }\";\n            case \"rejected\":\n                return \"Promise { <rejected> \" + this._reason + \" }\";\n        }\n    };\n\n    var isThenable = function (value) {\n        return isObject(value) && isCallable(value.then);\n    };\n\n    var defaultPromiseOnFulfilled = function (value) {\n        return Promise.resolve(value);\n    };\n\n    var defaultPromiseOnRejected = function (reason) {\n        return Promise.reject(reason);\n    };\n\n    var promiseResolve = function (value) {\n        // Just return if the promise is settled already\n        if (isSettledPromise(this))\n            return;\n        defineProperties(this, {\n            _state: {\n                value: \"fulfilled\"\n            },\n            _value: {\n                value: value\n            }\n        });\n        if (this._onFulfilled.length > 0) {\n            postToMessageQueue(function (value) {\n                this._onFulfilled.forEach(function (callback) {\n                    callback(value);\n                });\n                // Free the references of the callbacks, because\n                // these are not needed anymore after calling first time _resolve() method\n                this._onFulfilled.length = 0;\n                this._onRejected.length = 0;\n            }, this, value);\n        }\n    };\n\n    var promiseReject = function (reason) {\n        // Just return if the promise is settled already\n        if (isSettledPromise(this))\n            return;\n        defineProperties(this, {\n            _state: {\n                value: \"rejected\"\n            },\n            _reason: {\n                value: reason\n            }\n        });\n        if (this._onRejected.length > 0) {\n            postToMessageQueue(function (reason) {\n                this._onRejected.forEach(function (callback) {\n                    callback(reason);\n                });\n                // Free the references of the callbacks, because\n                // these are not needed anymore after calling first time _reject() method\n                this._onFulfilled.length = 0;\n                this._onRejected.length = 0;\n            }, this, reason);\n        }\n    };\n\n    var setupPromiseInternals = function (promise) {\n        defineProperties(promise, {\n            _isPromise: {\n                value: true\n            },\n            _onFulfilled: {\n                value: []\n            },\n            _onRejected: {\n                value: []\n            },\n            _resolve: {\n                value: promiseResolve.bind(promise),\n                configurable: true\n            },\n            _reject: {\n                value: promiseReject.bind(promise),\n                configurable: true\n            },\n            _state: {\n                value: \"pending\",\n                configurable: true\n            },\n            _value: {\n                value: undefined,\n                configurable: true\n            },\n            _reason: {\n                value: undefined,\n                configurable: true\n            }\n        });\n    };\n\n    var isPendingPromise = function (promise) {\n        return promise._state === \"pending\";\n    };\n\n    var isFulfilledPromise = function (promise) {\n        return promise._state === \"fulfilled\";\n    };\n\n    var isRejectedPromise = function (promise) {\n        return promise._state === \"rejected\";\n    };\n\n    var isSettledPromise = function (promise) {\n        return promise._state === \"fulfilled\" || promise._state === \"rejected\";\n    };\n\n    var isValidPromiseState = function (state) {\n        return [\"pending\", \"fulfilled\", \"rejected\"].indexOf(String(state)) !== -1;\n    };\n\n    var checkPromiseInternals = function (promise) {\n        return promise._isPromise === true\n            && isArray(promise._onFulfilled)\n            && isArray(promise._onRejected)\n            && isCallable(promise._resolve)\n            && isCallable(promise._reject)\n            && isValidPromiseState(promise._state)\n            && promise.hasOwnProperty(\"_value\")\n            && promise.hasOwnProperty(\"_reason\")\n    };\n\n    var isPromise = function (promise) {\n        return promise instanceof Promise && checkPromiseInternals(promise);\n    };\n\n    // export ES6 APIs and add all the patches to support Promise in ES5\n    // If the running environment already supports ES6 then no patches will be applied,\n    if (isES6Running())\n        return ES6;\n    else {\n        defineProperties(ES6, {\n            isPromise: {\n                value: isPromise,\n                writable: true,\n                configurable: true\n            }\n        });\n\n        defineProperty(global, \"Promise\", {\n            value: Promise,\n            writable: true,\n            configurable: true\n        });\n    }\n\n    return ES6;\n});\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","import 'es6-promise-shim';\n\nimport {Dom} from './ui/Dom';\nimport {Popup} from './ui/Popup';\nimport {Assets} from './Assets';\nimport {KeyboardControls} from './controls/KeyboardControls';\nimport {TouchControls} from './controls/TouchControls';\nimport {Game, GameEvents} from './game/Game';\nimport {Score} from './ui/Score';\nimport {MuteButton} from './ui/MuteButton';\nimport {GameOverPopup} from './ui/GameOverPopup';\nimport {LoaderPopup} from './ui/LoaderPopup';\n\nclass App {\n\n    body: Dom;\n    game: Game;\n    keyboard: KeyboardControls;\n    touch: TouchControls;\n    score: Score;\n    muteButton: MuteButton;\n    beforeinstallprompt: Event;\n\n    constructor(body: HTMLElement) {\n        this.body = new Dom(body);\n        this.keyboard = new KeyboardControls();\n        this.touch = new TouchControls();\n        this.score = new Score(this.body);\n        this.muteButton = new MuteButton(this.body);\n    }\n\n    reset() {\n        this.score.resetPoints();\n        this.game.reset();\n    }\n\n    pause() {\n        if (this.game.paused || !this.game.started || this.game.worm.dead) {\n            return;\n        }\n\n        this.keyboard.deattach(this.game);\n        this.touch.deattach(this.game);\n        this.game.pause();\n\n        Popup.open({\n            header: 'Paused',\n            body: 'Game is now paused.',\n            button: 'Resume',\n            animation: true\n        }).result\n            .then(() => this.resume())\n            .catch(() => this.resume());\n    }\n\n    resume() {\n        this.keyboard.attach(this.game);\n        this.touch.attach(this.game);\n        this.game.resume()\n    }\n\n    registerServiceWorker() {\n        if ('serviceWorker' in navigator) {\n            navigator.serviceWorker.register('/service-worker.js')\n                .then(registration => {\n                    console.log('ServiceWorker registration successful with scope: ', registration.scope);\n                }, err => {\n                    console.log('ServiceWorker registration failed: ', err);\n                });\n        }\n    }\n\n    init() {\n        let gameCanvas = <HTMLCanvasElement>this.body.names['gameCanvas'];\n        this.game = new Game(15, 15, gameCanvas);\n\n        this.keyboard.attach(this.game);\n        this.touch.attach(this.game);\n\n        this.game.emitter.on(GameEvents.GAME_OVER, () => {\n            if (!this.muteButton.mute) {\n                Assets.dead.play();\n            }\n\n            if (this.beforeinstallprompt) {\n                (this.beforeinstallprompt as any).prompt();\n                this.beforeinstallprompt = undefined;\n            }\n\n            GameOverPopup.open(this.score.points).result\n                .then(() => this.reset())\n                .catch(() => this.reset());\n        });\n\n        this.game.emitter.on(GameEvents.ADD_POINT, () => {\n            this.score.addPoint();\n            if (!this.muteButton.mute) {\n                Assets.point.play();\n            }\n        });\n\n        this.game.emitter.on(GameEvents.KEY, () => {\n            if (!this.muteButton.mute) {\n                Assets.pop.play();\n            }\n        });\n\n        this.body.on('click', this.body.names['pauseButton'], (event: Event) => {\n            this.pause();\n        });\n\n        this.body.on('click', this.body.names['soundButton'], (event: Event) => {\n            this.muteButton.toggleMute();\n        });\n    }\n}\n\nlet body: HTMLElement = window.document.getElementsByTagName('body')[0];\nlet app: App = new App(body);\n\nlet loaderPopup = LoaderPopup.open();\n\n\n// Save install prompt after finished first play\nwindow.addEventListener('beforeinstallprompt', function (event: Event) {\n    app.beforeinstallprompt = event;\n    event.preventDefault();\n    return false;\n});\n\n// Pause the game when backgrounded\nwindow.onblur = () => {\n    app.pause();\n};\n\nAssets.loadAll()\n    .then(() => {\n        loaderPopup.close('done');\n        app.init();\n        app.registerServiceWorker();\n    })\n    .catch(() => {\n        loaderPopup.dismiss('error');\n        Popup.open({\n            header: 'Uh, oh!',\n            error: true,\n            body: new Dom('<h3>The game was not initialized correctly.</h3>'),\n            button: 'Reload',\n            buttonCallback: () => window.location.reload(),\n            backdrop: false,\n            animation: true\n        });\n    });\n","\nimport {Sound} from './Sound';\n\nexport class Assets {\n\n    static pop: Sound;\n    static point: Sound;\n    static dead: Sound;\n    static berry: HTMLImageElement;\n    static head: HTMLImageElement;\n\n    static loadImage(path: string): Promise<HTMLImageElement> {\n        return new Promise<HTMLImageElement>((resolve: any, reject: any) => {\n            let image: HTMLImageElement = new Image();\n            image.src = path;\n            image.onload = () => {\n                resolve(image);\n            };\n            image.onerror = () => {\n                reject(null);\n            }\n        });\n    }\n\n    static loadAll(): Promise<any> {\n        return this.loadImage('images/berry-small.png')\n            .then(image => this.berry = image)\n            .then(() => this.loadImage('images/snake-head.png'))\n            .then(image => this.head = image)\n            .then(() => {\n                this.pop = new Sound('images/pop.mp3');\n                return this.pop.load();\n            })\n            .then(() => {\n                this.point = new Sound('images/point.mp3');\n                return this.point.load();\n            })\n            .then(() => {\n                this.dead = new Sound('images/dead.mp3');\n                return this.dead.load();\n            });\n    }\n\n}\n","import {Dom} from './ui/Dom';\n\nexport class Sound {\n\n    static audioCtx: any;\n    audio: HTMLAudioElement;\n    buffer: Uint8Array;\n    loaded: boolean = false;\n    path: string;\n\n    constructor(path: string) {\n        this.path = path;\n    }\n\n    private loadAudioCtx(): Promise<Sound> {\n        return new Promise((resolve: any, reject: any) => {\n            let request: XMLHttpRequest = new XMLHttpRequest();\n\n            request.open('GET', this.path, true);\n            request.responseType = 'arraybuffer';\n\n            request.onload = () => {\n                let audioData = request.response;\n\n                Sound.audioCtx.decodeAudioData(audioData, (buffer: Uint8Array) => {\n                    this.buffer = buffer;\n                    this.loaded = true;\n                    resolve(this);\n\n                }, (error: any) => {\n                    reject(null);\n                });\n            }\n\n            request.onerror = (error: ErrorEvent) => {\n                reject(null);\n            }\n\n            request.send();\n        });\n    }\n\n    load(): Promise<any> {\n        if (Sound.audioCtx) {\n            return this.loadAudioCtx();\n        }\n\n        return new Promise<Sound>((resolve: any, reject: any) => {\n            this.audio = new Audio(this.path);\n            this.audio.onloadeddata = () => {\n                this.loaded = true;\n                resolve(this);\n            };\n            this.audio.onerror = (error: ErrorEvent) => {\n                console.error(error);\n                reject(null);\n            }\n        });\n    }\n\n    play() {\n        if (!this.loaded) {\n            return;\n        }\n\n        if (Sound.audioCtx && this.buffer) {\n            let source: any = Sound.audioCtx.createBufferSource();\n            source.buffer = this.buffer;\n            source.connect(Sound.audioCtx.destination);\n            source.start(0);\n\n        } else if (this.audio) {\n            if (this.audio.paused) {\n                this.audio.play();\n            } else {\n                this.audio.currentTime = 0;\n                \n            }\n        }\n    }\n\n}\n\n\n// Initialize AudioContext\n(function init() {\n    let AudioCtx = (window as any).AudioContext || (window as any).webkitAudioContext;\n\n    // Api supported\n    if (!AudioCtx) {\n        return;\n    }\n\n    Sound.audioCtx = new AudioCtx();\n\n    // Sound is suspended, we have to unlock it\n    if (Sound.audioCtx.state !== 'suspended') {\n        return;\n    }\n\n    let body = document.body;\n    let resume = function () {\n        Sound.audioCtx.resume();\n\n        setTimeout(() => {\n            if (Sound.audioCtx.state === 'running') {\n                body.removeEventListener('touchstart', resume, false);\n                body.removeEventListener('keydown', resume, false);\n            }\n        });\n    };\n\n    body.addEventListener('touchstart', resume, false);\n    body.addEventListener('keydown', resume, false);\n}());\n","'use strict';\n\nimport {Keys} from './Keys';\n\nexport interface Controllable {\n    onKey: (key: Keys) => void\n};\n\nexport abstract class Controls {\n\n    listeners: Controllable[] = [];\n\n    attach(controllable: Controllable) {\n        this.listeners.push(controllable);\n    }\n    \n    deattach(controllable: Controllable) {\n        let index: number = this.listeners.indexOf(controllable);\n        if (index !== -1) {\n            this.listeners.splice(index, 1);\n        }\n    }\n\n    triggerKey(key: Keys) {\n        for (let i = 0; i < this.listeners.length; i++) {\n            this.listeners[i].onKey(key);\n        }\n    }\n\n}\n","'use strict';\n\nimport {Keys} from './Keys';\nimport {Controls} from './Controls';\n\nconst KEY_TO_DIRECTION: {[keyCode:number]: Keys} = {\n    38: Keys.UP, // ArrowUp,\n    37: Keys.LEFT, // ArrowLeft,\n    40: Keys.DOWN, // ArrowDown,\n    39: Keys.RIGHT, // ArrowRight,\n    87: Keys.UP, // KeyW,\n    65: Keys.LEFT, // 'KeyA,\n    83: Keys.DOWN, // 'KeyS,\n    68: Keys.RIGHT // 'KeyD\n};\n\nexport class KeyboardControls extends Controls {\n\n    keyDownCallback: (event: Event) => void;\n\n    constructor() {\n        super();\n\n        this.keyDownCallback = (event: KeyboardEvent) => {\n            let keyCode: number = event.keyCode || event.which;\n            let key: Keys = KEY_TO_DIRECTION[keyCode];\n\n            if (key !== undefined) {\n                this.triggerKey(key);\n            }\n        }\n\n        this.keyDownCallback = this.keyDownCallback.bind(this);\n        window.addEventListener('keydown', this.keyDownCallback);\n    }\n\n    remove() {\n        window.removeEventListener('keydown', this.keyDownCallback);\n    }\n}\n","\nexport enum Keys {\n    UP = 0,\n    DOWN = 1,\n    LEFT = 2,\n    RIGHT = 3,\n    ACTION = 4\n};\n","'use strict';\n\nimport {Keys} from './Keys';\nimport {Controls} from './Controls';\n\ninterface Position {\n    x: number,\n    y: number,\n    time: number\n};\n\nconst MOUSE_BUFFER_TIME = 200;\nconst MIN_DIFFERENCE = Math.min(window.innerWidth, window.innerHeight) / 10;\n\nexport class TouchControls extends Controls {\n\n    onStart: (event: Event) => void;\n    onMove: (event: Event) => void;\n    onStop: (event: Event) => void;\n    onCancel: (event: Event) => void;\n\n    queue: Position[] = [];\n    pressTime: number = 0;\n    moved: boolean = false;\n\n    constructor() {\n        super();\n\n        this.onStart = (event: TouchEvent) => {\n            this.pressTime = Date.now();\n            this.moved = false;\n        }\n\n        this.onMove = (event: TouchEvent) => {\n            if (!this.pressTime) {\n                return;\n            }\n            this.appendPos(event.touches[0].clientX, event.touches[0].clientY);\n            this.checkMove();\n\n            // prevent bounce-scroll, refresh on scroll-top and others.\n            event.preventDefault();\n        }\n\n        this.onStop = (event: TouchEvent) => {\n            let now = Date.now();\n            this.pressTime = 0;\n        }\n\n        this.onCancel = (event: TouchEvent) => {\n            this.pressTime = 0;\n        }\n\n        window.addEventListener('touchstart', this.onStart);\n        window.addEventListener('touchmove', this.onMove);\n        window.addEventListener('touchend', this.onStop);\n        window.addEventListener('touchcancel', this.onCancel);\n    }\n\n    appendPos(x: number, y: number) {\n        let pos: Position = {x: x, y: y, time: Date.now()};\n        let threshold = pos.time - MOUSE_BUFFER_TIME;\n        this.queue.push(pos);\n\n        for (let i = this.queue.length - 1; i >= 0; i--) {\n            if (this.queue[i].time < threshold) {\n                this.queue.splice(0, i + 1);\n                break;\n            }\n        }\n    }\n\n    private checkMove() {\n        let len = this.queue.length;\n\n        if (len < 2) {\n            return;\n        }\n\n        let first: Position = this.queue[0];\n        let last: Position = this.queue[len - 1];\n\n        let diffX = first.x - last.x;\n        let diffY = first.y - last.y;\n\n        if (Math.abs(diffX) >= Math.abs(diffY)) {\n            if (diffX > MIN_DIFFERENCE) {\n                this.triggerKey(Keys.LEFT);\n                this.moved = true;\n            } else if (diffX < -MIN_DIFFERENCE) {\n                this.triggerKey(Keys.RIGHT);\n                this.moved = true;\n            }\n        } else {\n            if (diffY > MIN_DIFFERENCE) {\n                this.triggerKey(Keys.UP);\n                this.moved = true;\n            } else if (diffY < -MIN_DIFFERENCE) {\n                this.triggerKey(Keys.DOWN);\n                this.moved = true;\n            }\n        }\n    }\n\n    remove() {\n        window.removeEventListener('touchstart', this.onStart);\n        window.removeEventListener('touchmove', this.onMove);\n        window.removeEventListener('touchend', this.onStop);\n        window.removeEventListener('touchcancel', this.onCancel);\n    }\n}\n","import {Assets} from '../Assets';\nimport {Point} from './Point';\nimport {Renderable, CELL_SIZE} from './Renderer';\n\nconst MAX_MARGIN = 4;\nconst CYCLE = 800;\n\nexport class Berry extends Point implements Renderable {\n\n    render(ctx: CanvasRenderingContext2D, time: number) {\n        let x, y, pulse;\n        let margin, size;\n\n        x = this.x * CELL_SIZE;\n        y = this.y * CELL_SIZE;\n\n        pulse = (time % CYCLE) / CYCLE;\n        if (pulse > 0.5) {\n            pulse = 1 - pulse;\n        }\n\n        margin = pulse * MAX_MARGIN;\n        size = CELL_SIZE - 2 * margin;\n\n        ctx.drawImage(Assets.berry, 0, 0, 32, 32, x + margin, y + margin, size, size);\n    }\n}\n","import {Point} from './Point';\nimport {Berry} from './Berry';\nimport {Worm, WormSegment} from './Worm';\nimport {Renderable, Renderer} from './Renderer';\nimport {Controllable} from '../controls/Controls';\nimport {Emitter} from '../ui/Emitter';\nimport {Keys} from '../controls/Keys';\n\nexport enum GameEvents {\n    GAME_OVER,\n    ADD_POINT,\n    KEY\n}\n\nconst MAX_SNAKE_LENGTH = 75;\nconst SNAKE_SPPEDUP = 0.05;\n\nexport class Game implements Renderable, Controllable {\n\n    sizeX: number;\n    sizeY: number;\n    berries: Berry[];\n    worm: Worm;\n    board: Point[][];\n    emitter: Emitter<GameEvents, void>;\n    renderer: Renderer;\n    gameLoop: () => void;\n\n    paused: boolean = false;\n    started: boolean = false;\n    frameTime: number;\n\n    constructor(sizeX: number, sizeY: number, canvas: HTMLCanvasElement) {\n        this.sizeX = sizeX;\n        this.sizeY = sizeY;\n\n        this.renderer = new Renderer(sizeX, sizeY, canvas);\n        this.emitter = new Emitter<GameEvents, void>();\n\n        this.gameLoop = () => {\n            if (this.paused || !this.started || this.worm.dead) {\n                return;\n            }\n            let time: number = Date.now();\n            let deltaTime: number = 0;\n            if (this.frameTime !== undefined) {\n                deltaTime = time - this.frameTime;\n            }\n            this.frameTime = time;\n\n            this.simulate(deltaTime);\n            this.updateFrame(time);\n            requestAnimationFrame(this.gameLoop);\n        };\n\n        this.gameLoop = this.gameLoop.bind(this);\n\n        this.reset();\n    }\n\n    reset() {\n        this.started = false;\n        this.worm = new Worm(2, Math.floor(this.sizeY / 2), Keys.RIGHT);\n        this.berries = [];\n        this.frameTime = undefined;\n\n        this.updateBoard();\n        this.addBerry();\n\n        this.updateFrame();\n    }\n\n    private updateBoard(): void {\n        this.board = new Array(this.sizeX);\n        for (let i = 0; i < this.sizeX; i++) {\n            this.board[i] = new Array(this.sizeY);\n        }\n        this.worm.segments.forEach(p => this.board[p.x][p.y] = p);\n    }\n\n    private updateFrame(time: number = 0): void {\n        this.renderer.clearFrame();\n        this.render(this.renderer.ctx, time);\n    }\n\n    private addBerry(): void {\n        let l = this.sizeX * this.sizeY;\n        let offset = Math.round(Math.random() * (l - 1));\n        let x, y;\n\n        for (let i = 0; i < l ; i++) {\n            x = (i + offset) % this.sizeX;\n            y = Math.floor((i + offset) / this.sizeX) % this.sizeY;\n            if (!this.board[x][y]) {\n                break;\n            }\n        }\n\n        let berry = new Berry(x, y);\n        this.berries.push(berry);\n        this.board[x][y] = berry;\n    }\n\n    simulate(deltaTime: number) {\n        let head: WormSegment;\n        let tail: WormSegment;\n        let index: number;\n        let isKeyEvent: boolean = false;\n\n        this.worm.offset += this.worm.speed * deltaTime / 1000;\n\n        if (this.worm.offset >= 1.0) {\n            head = this.worm.segments[this.worm.segments.length - 1];\n\n            // check if worm have changed the direction\n            if (head.direction !== this.worm.direction) {\n                isKeyEvent = true;\n            }\n\n            head = this.worm.createNewSegment();\n        }\n\n        while (this.worm.offset >= 1.0) {\n            if (this.board[head.x][head.y] instanceof Berry) {\n                if (this.worm.segments.length < MAX_SNAKE_LENGTH) {\n                    head.swallowing = true;\n                    this.worm.speed += SNAKE_SPPEDUP;\n                }\n                index = this.berries.indexOf(<Berry>this.board[head.x][head.y]);\n                this.berries.splice(index, 1);\n                this.emitter.trigger(GameEvents.ADD_POINT);\n                this.addBerry();\n            }\n\n            tail = this.worm.segments[0];\n            if (!tail.swallowing) {\n                this.worm.segments.shift();\n                this.board[tail.x][tail.y] = undefined;\n            }\n            tail.swallowing = false;\n\n            this.worm.segments.push(head);\n            this.board[head.x][head.y] = head;\n            this.worm.offset -= 1.0;\n\n            head = this.worm.createNewSegment();            \n\n            if (head.x < 0 || head.y < 0 ||\n                head.x >= this.sizeX || head.y >= this.sizeY ||\n                this.board[head.x][head.y] instanceof WormSegment\n            ) {\n                this.worm.dead = true;\n                this.worm.offset = 0;\n                this.emitter.trigger(GameEvents.GAME_OVER);\n                return;\n            }\n        }\n\n        if (isKeyEvent && !this.worm.dead) {\n            this.emitter.trigger(GameEvents.KEY);\n        }\n    }\n\n    public pause() {\n        this.paused = true;\n    }\n\n    public resume() {\n        this.paused = false;\n        this.frameTime = undefined;\n        this.gameLoop();\n    }\n\n    render(ctx: CanvasRenderingContext2D, time: number) {\n        for (let i = 0; i < this.berries.length; i++) {\n            this.berries[i].render(ctx, time);\n        }\n        this.worm.render(ctx, time);\n    }\n\n    onKey(key: Keys) {\n        if (this.started === false) {\n            this.started = true;\n            this.gameLoop();\n        }\n\n        let head = this.worm.segments[this.worm.segments.length - 1];\n\n        if (key === Keys.UP && head.direction !== Keys.DOWN) {\n            this.worm.direction = key;\n        } else if (key === Keys.DOWN && head.direction !== Keys.UP) {\n            this.worm.direction = key;\n        } else if (key === Keys.LEFT && head.direction !== Keys.RIGHT) {\n            this.worm.direction = key;\n        } else if (key === Keys.RIGHT && head.direction !== Keys.LEFT) {\n            this.worm.direction = key;\n        }\n    }\n\n}\n","export abstract class Point {\n    x: number;\n    y: number;\n\n    constructor (x: number, y: number) {\n        this.x = x;\n        this.y = y;\n    }\n}\n\nexport type Board = Point[][];\n","\nexport interface Renderable {\n    render(ctx: CanvasRenderingContext2D, time: number): void;\n}\n\nexport const CELL_SIZE: number = 32;\n\nexport class Renderer {\n    sizeX: number;\n    sizeY: number;\n\n    canvas: HTMLCanvasElement;\n    ctx: CanvasRenderingContext2D;\n\n    constructor(sizeX: number, sizeY: number, canvas: HTMLCanvasElement) {\n        this.canvas = canvas;\n        this.sizeX = sizeX;\n        this.sizeY = sizeY;\n\n        this.canvas.width = CELL_SIZE * sizeX;\n        this.canvas.height = CELL_SIZE * sizeY;\n\n        this.ctx =  canvas.getContext(\"2d\");\n    }\n\n    clearFrame() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n}\n","import {Assets} from '../Assets';\nimport {Point} from './Point';\nimport {Renderable, CELL_SIZE} from './Renderer';\nimport {Keys} from '../controls/Keys';\n\nexport class WormSegment extends Point {\n    direction: Keys;\n\n    swallowing: boolean = false;\n\n    constructor (x: number, y: number, direction: Keys) {\n        super(x, y);\n        this.direction = direction;\n    }\n}\n\n\nexport class Worm implements Renderable {\n    segments: WormSegment[];\n\n    direction: Keys;\n\n    speed: number = 4.0;    // one square per second\n\n    offset: number = 0.0; // from 0 to 1\n\n    dead: boolean = false;\n    \n    color: string = '#4c9ed9';\n\n    constructor (x: number, y: number, direction: Keys, length: number = 3) {\n        this.direction = direction;\n        this.segments = [];\n\n        this.segments.push(new WormSegment(x, y, direction));\n        while (this.segments.length < length) {\n            this.segments.push(this.createNewSegment());\n        }\n    }\n\n    private moveX(x: number, direction: Keys, value: number = 1) {\n        switch (direction) {\n            case Keys.LEFT:\n                return x - value;\n            case Keys.RIGHT:\n                return x + value;\n        }\n        return x;\n    }\n\n    private moveY(y: number, direction: Keys, value: number = 1) {\n        switch (direction) {\n            case Keys.UP:\n                return y - value;\n            case Keys.DOWN:\n                return y + value;\n        }\n        return y;\n    }\n\n    createNewSegment(): WormSegment {\n        let head = this.segments[this.segments.length - 1];\n        let newHead = new WormSegment(head.x, head.y, this.direction);\n        newHead.x = this.moveX(newHead.x, head.direction);\n        newHead.y = this.moveY(newHead.y, head.direction);\n        return newHead;\n    }\n\n    drawFace(ctx: CanvasRenderingContext2D, head: WormSegment, x: number, y: number, time: number) {\n        const SIZE = 20;\n        let eyesType = 0;\n\n        if (this.dead) {\n            eyesType = 2;\n        } else if (time % 2000 < 1000 && time % 1000 > 700) {\n            // blink eyes every 2 seconds, for 300 ms\n            eyesType = 1;\n        }\n\n        ctx.drawImage(\n            Assets.head,\n            head.direction * SIZE,\n            eyesType * SIZE,\n            SIZE, SIZE, x, y, SIZE, SIZE\n        );\n    }\n\n    render(ctx: CanvasRenderingContext2D, time: number) {\n        const R = 0.3125;\n        const R2 = 0.4;\n        const MARGIN = 0.5 - R;\n\n        let tail: WormSegment = this.segments[0];\n        let head: WormSegment = this.segments[this.segments.length - 1];\n        let dx: number = tail.x, dy: number = tail.y;\n        let x: number, y: number, r: number;\n\n        r = R2 * CELL_SIZE;\n\n        ctx.fillStyle = this.color;\n        ctx.strokeStyle = this.color;\n        ctx.lineWidth = 2 * R * CELL_SIZE;\n        ctx.lineJoin = \"round\";\n        ctx.lineCap = \"round\";\n\n        // tail\n        if (!tail.swallowing) {\n            dx = this.moveX(tail.x, tail.direction, this.offset);\n            dy = this.moveY(tail.y, tail.direction, this.offset);\n        }\n        x = (dx + R + MARGIN) * CELL_SIZE;\n        y = (dy + R + MARGIN) * CELL_SIZE;\n\n        ctx.beginPath();\n        ctx.moveTo(x, y);\n\n        // body\n        for (let i = 1; i < this.segments.length; i++) {\n            if (this.segments[i - 1].direction !== this.segments[i].direction) {\n                x = (this.segments[i].x + R + MARGIN) * CELL_SIZE;\n                y = (this.segments[i].y + R + MARGIN) * CELL_SIZE;\n                ctx.lineTo(x, y);\n            }\n        }\n\n        // head\n        dx = this.moveX(head.x, head.direction, this.offset);\n        dy = this.moveY(head.y, head.direction, this.offset);\n        x = (dx + R + MARGIN) * CELL_SIZE;\n        y = (dy + R + MARGIN) * CELL_SIZE;\n        ctx.lineTo(x, y);\n        ctx.stroke();\n\n        // Swallowing segments\n        for (let i = 0; i < this.segments.length; i++) {\n            if (this.segments[i].swallowing) {\n                x = (this.segments[i].x + R + MARGIN) * CELL_SIZE;\n                y = (this.segments[i].y + R + MARGIN) * CELL_SIZE;\n                ctx.beginPath();\n                ctx.arc(x, y, r, 0, 2 * Math.PI);\n                ctx.fill();\n            }\n        }\n\n        // Face\n        x = (dx + MARGIN) * CELL_SIZE;\n        y = (dy + MARGIN) * CELL_SIZE;\n        this.drawFace(ctx, head, x, y, time);\n\n    }\n\n}\n","'use strict';\n\nconst ELEMENT_NODE: number = 1;\n\ntype ListenerItem = {\n    event: string,\n    element: HTMLElement,\n    callback: EventListenerOrEventListenerObject\n}\n\nexport class Dom {\n\n    element: HTMLElement;\n\n    private listeners: ListenerItem[];\n\n    public names: {[key:string]: HTMLElement} = {};\n\n    constructor(template: string | HTMLElement) {\n        let container : HTMLElement,\n            element : HTMLElement;\n\n        if ((<HTMLElement>template).nodeType === ELEMENT_NODE) {\n            element = <HTMLElement>template;\n        } else {\n            container = window.document.createElement('div');\n            container.innerHTML = <string>template;\n            element = this.findFirstElement(container.childNodes);\n        }\n\n        if (!element) {\n            throw new Error('Failed to compile template: ' + template);\n        }\n\n        this.generateNamedElements(element);\n        this.element = element;\n        this.listeners = [];\n    }\n\n    private findFirstElement(nodeList : NodeList) : HTMLElement {\n        let node: Node = null;\n\n        for (let i = 0; i < nodeList.length; i++) {\n\n            node = nodeList.item(i);\n\n            if (node.nodeType === ELEMENT_NODE) {\n                return <HTMLElement>node;\n            }\n        }\n\n        return null;\n    }\n\n    private generateNamedElements(element: HTMLElement) {\n        let elements: NodeListOf<Element> = element.querySelectorAll('[data-name]');\n        let name: string;\n\n        for (let i = 0; i < elements.length; i++) {\n            name = elements[i].getAttribute('data-name');\n            this.names[name] = <HTMLElement>elements[i];\n        }\n    }\n\n    append(element: Array<HTMLElement> | Array<Dom> | HTMLElement | Dom) {\n        if (element instanceof Array) {\n            for (let i = 0; i < element.length; i++) {\n                this.append(element[i]);\n            }\n            return;\n        }\n        if (element instanceof Dom) {\n            element = element.element;\n        }\n        this.element.appendChild(element);\n    }\n\n    remove(element : HTMLElement | Dom) {\n        if (element instanceof Dom) {\n            element = element.element;\n        }\n        this.element.removeChild(element);\n    }\n\n    static setText(element: HTMLElement, text: string) {\n        let textNode: Text = document.createTextNode(text);\n        element.innerText = textNode.textContent;\n    }\n\n    on(event: string, element: HTMLElement, callback: EventListenerOrEventListenerObject) {\n        if (arguments.length === 2) {\n            callback = <EventListenerOrEventListenerObject>arguments[1];\n            element = this.element;\n        }\n\n        this.listeners.push({\n            event, element, callback\n        });\n\n        element.addEventListener(event, callback);\n    }\n\n    off(\n        element: HTMLElement = undefined,\n        event: string = undefined,\n        callback: EventListenerOrEventListenerObject = undefined\n    ) {\n        let item: ListenerItem;\n\n        function isMatchingListener(listener: ListenerItem): boolean {\n            if (element === undefined) {\n                return true;\n            }\n            if (element !== listener.element) {\n                return false;\n            }\n            if (event === undefined) {\n                return true;\n            }\n            if (event !== listener.event) {\n                return false;\n            }\n            if (callback === undefined) {\n                return true;\n            }\n            if (callback !== listener.callback) {\n                return false;\n            }\n        }\n\n        for (let i = this.listeners.length - 1; i >= 0; i--) {\n            item = this.listeners[i];\n            if (isMatchingListener(item)) {\n                item.element.removeEventListener(item.event, item.callback);\n                this.listeners.splice(i, 1);\n            }\n        }\n    }\n}\n","'use strict';\n\ninterface Listener<T, U> {\n    event: T,\n    callback: (param?: U) => void\n}\n\nexport class Emitter<T, U> {\n\n    private listeners: Listener<T, U>[] = [];\n\n    on(event: T, callback: (param?: U) => void): void {\n        this.listeners.push({\n            event: event,\n            callback: callback\n        });\n    }\n\n    off(event?: T, callback?: (param?: U) => void): void {\n        let item: Listener<T, U>;\n\n        function isMatchingListener(listener: Listener<T, U>): boolean {\n            if (event === undefined) {\n                return true;\n            }\n            if (event !== listener.event) {\n                return false;\n            }\n            if (callback === undefined) {\n                return true;\n            }\n            if (callback !== listener.callback) {\n                return false;\n            }\n        }\n\n        for (let i = this.listeners.length - 1; i >= 0; i--) {\n            item = this.listeners[i];\n            if (isMatchingListener(item)) {\n                this.listeners.splice(i, 1);\n            }\n        }\n    }\n\n    trigger(event: T, param?: U): void {\n        let item: Listener<T, U>;\n\n        for (let i = this.listeners.length - 1; i >= 0; i--) {\n            item = this.listeners[i];\n            if (item.event === event) {\n                item.callback.call(null, param);\n            }\n        }\n    }\n}\n","'use strict';\n\nimport {Dom} from './Dom';\nimport {Popup} from './Popup';\n\nexport class GameOverPopup {\n\n    static open(points: number): Popup {\n\n        let template =\n            '<div class=\"u-text-center\">' +\n                '<h3>Your final score is:</h3>' +\n                `<div class=\"c-score c-score--huge c-score--points\">${points}</div>` +\n            '</div>';\n\n        return Popup.open({\n            header: 'Well done!',\n            body: new Dom(template),\n            button: 'Try again',\n            animation: true\n        });\n    }\n}\n","'use strict';\n\nimport {Dom} from './Dom';\nimport {Popup} from './Popup';\n\nlet template = `<div class=\"c-loader\">\n    <span class=\"c-loader__ball\"></span>\n    <span class=\"c-loader__ball\"></span>\n    <span class=\"c-loader__ball\"></span>\n    <span class=\"c-loader__ball\"></span>\n    <span class=\"c-loader__ball\"></span>\n</div>`;\n\nexport class LoaderPopup {\n\n    static open(): Popup {\n        return Popup.open({\n            header: 'Loading...',\n            body: new Dom(template)\n        });\n    }\n}\n","import {Dom} from './Dom';\n\nconst SOUND = 'sound';\nconst MUTED_CLASS = 'muted';\n\nexport class MuteButton {\n\n    soundElement: HTMLElement;\n    mute: boolean = false;\n\n    constructor(body: Dom) {\n        this.soundElement = body.names['soundButton'];\n        this.loadMute();\n    }\n\n    loadMute() {\n        let value: string = window.localStorage.getItem(SOUND);\n        if (value !== null) {\n            this.mute = (value === 'true');\n        }\n\n        if (this.mute) {\n            this.soundElement.classList.add(MUTED_CLASS);\n        } else {\n            this.soundElement.classList.remove(MUTED_CLASS);\n        }\n    }\n\n    toggleMute() {\n        this.mute = !this.mute;\n        window.localStorage.setItem(SOUND, this.mute ? 'true' : 'false');\n\n        if (this.mute) {\n            this.soundElement.classList.add(MUTED_CLASS);\n        } else {\n            this.soundElement.classList.remove(MUTED_CLASS);\n        }\n    }\n\n    play(sound: HTMLAudioElement) {\n        if (this.mute) {\n            return;\n        }\n\n        if (sound.paused) {\n            sound.play();\n        } else {\n            sound.currentTime = 0;\n        }\n    }\n\n}\n","'use strict';\n\nimport {Dom} from './Dom';\n\ninterface PopupParams {\n    header: string,\n    body: Dom | string,\n    button?: string,\n    buttonCallback?: Function,\n    backdrop?: boolean,\n    error?: boolean,\n    animation?: boolean\n}\n\nlet template = `\n<div class=\"c-modal\">\n    <div class=\"c-modal__popup c-modal__popup--sm\" data-name=\"popup\">\n        <div class=\"c-modal__popup__header\"><h2 data-name=\"header\"></h2></div>\n        <div class=\"c-modal__popup__body\" data-name=\"message\"></div>\n        <div class=\"c-modal__popup__footer\" data-name=\"footer\"></div>\n    </div>\n</div>`;\n\nconst MODAL_WITH_ANIMATION_CLASS = 'c-modal--with-animation';\nconst MODAL_WITH_ERROR_CLASS = 'c-modal--with-error';\n\nexport class Popup {\n    result: Promise<any>;\n\n    element: Dom;\n    \n    container: HTMLElement;\n\n    private resolve: (value: any) => void;\n    private reject: (reason: any) => void;\n\n    constructor(element: Dom, container: HTMLElement = undefined) {\n        this.result = new Promise<any>((resolve: any, reject: any) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n\n        this.element = element;\n\n        if (container === undefined) {\n            container = window.document.getElementsByTagName('body')[0];\n        }\n        this.container = container;\n        this.container.appendChild(this.element.element)\n    }\n\n    close(value: any) {\n        this.resolve(value);\n        this.element.off();\n        this.container.removeChild(this.element.element);\n    }\n\n    dismiss(reason: any) {\n        this.reject(reason);\n        this.element.off();\n        this.container.removeChild(this.element.element);\n    }\n\n    static open(params: PopupParams): Popup {\n        let element: Dom = new Dom(template);\n        let dom: Dom;\n\n        if (params.animation) {\n            element.element.classList.add(MODAL_WITH_ANIMATION_CLASS);\n        }\n\n        if (params.error) {\n            element.element.classList.add(MODAL_WITH_ERROR_CLASS);\n        }\n\n        if (params.body instanceof Dom) {\n            dom = params.body;\n        } else {\n            dom = new Dom(`<p>${params.body}</p>`);\n        }\n\n        Dom.setText(element.names['header'], params.header);\n        element.names['message'].appendChild(dom.element);\n\n        let popup: Popup = new Popup(element);\n\n        element.on('click', element.names['popup'], (event: Event) => {\n            event.stopPropagation();\n            event.preventDefault();\n        });\n\n        if (params.button) {\n            dom = new Dom(`<span class=\"c-modal__button\">${params.button}</span>`);\n            element.names['footer'].appendChild(dom.element);\n\n            element.on('click', dom.element, (event: Event) => {\n                if (params.buttonCallback) {\n                    params.buttonCallback();\n                } else {\n                    popup.close('button');\n                }\n            });\n        }\n\n        if (params.backdrop !== false) {\n            element.on('click', element.element, (event: Event) => {\n                popup.dismiss('overlay');\n            });\n        }\n\n        return popup;\n    }\n}\n","import {Dom} from './Dom';\n\nconst HISCORE = 'hiscore';\n\nconst POINTS_PER_COLOR = 10;\n\nconst BODY_COLORS = [\n    '#71beb8', '#03A9F4', '#1fda5e', '#FFBB00', '#FB6542', '#fd81fb',\n    '#067a00', '#0008a8', '#8d0000', '#ccc', '#000'\n];\n\nexport class Score {\n\n    body: Dom;\n    pointsElement: HTMLElement;\n    hiscoreElement: HTMLElement;\n    hiscore: number = 0;\n    points: number = 0;\n\n    constructor(body: Dom) {\n        this.body = body;\n        this.pointsElement = body.names['points'];\n        this.hiscoreElement = body.names['hiscore'];\n        this.loadHiscore();\n        Dom.setText(this.hiscoreElement, String(this.hiscore));\n    }\n\n    loadHiscore() {\n        this.hiscore = 0;\n        let value: string = window.localStorage.getItem(HISCORE);\n        if (value !== null) {\n            this.hiscore = parseInt(value, 10);\n        }\n    }\n\n    setHiscore(score: number) {\n        this.hiscore = score;\n        window.localStorage.setItem(HISCORE, String(score));\n        Dom.setText(this.hiscoreElement, String(this.hiscore));\n    }\n\n    private updateBodyColor(): void {\n        let index = Math.floor(this.points / POINTS_PER_COLOR);\n        index = index % BODY_COLORS.length;\n        if (this.body.element.style.background !== BODY_COLORS[index]) {\n            this.body.element.style.background = BODY_COLORS[index];\n        }\n    }\n\n    addPoint(points: number = 1) {\n        this.points += points;\n        this.updateBodyColor();\n\n        Dom.setText(this.pointsElement, String(this.points));\n        if (this.points > this.hiscore) {\n            this.setHiscore(this.points);\n        }\n    }\n\n    resetPoints() {\n        this.points = 0;\n        this.updateBodyColor();\n        Dom.setText(this.pointsElement, String(this.points));\n    }\n\n}\n"]}